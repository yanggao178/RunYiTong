# 相册选择垂直方向测试指南

## 修改内容
已将开方fragment中从相册选择图片时打开的相册界面强制设置为垂直方向（Portrait模式）。

## 修改详情

### 1. 修改的文件
- `PrescriptionFragment.java` - 开方Fragment逻辑文件

### 2. 具体修改
- 在`openGallery()`方法中添加了强制纵向模式的设置
- 在`openCamera()`方法中添加了强制纵向模式的设置
- 添加了`restoreScreenOrientation()`方法来恢复屏幕方向
- 在图片选择完成后自动恢复屏幕方向

### 3. 技术实现
```java
// 强制使用纵向模式
intent.addFlags(Intent.FLAG_ACTIVITY_NEW_TASK);
// 设置屏幕方向为纵向
if (getActivity() != null) {
    getActivity().setRequestedOrientation(ActivityInfo.SCREEN_ORIENTATION_PORTRAIT);
}
```

## 测试步骤

### 1. 启动应用
- 确保后端服务器正在运行
- 启动Android应用
- 点击底部导航的"开方"选项

### 2. 测试相册选择
- 点击输入框右侧的图片图标
- 在弹出的对话框中选择"从相册选择"
- 观察相册界面是否强制显示为垂直方向

### 3. 测试相机拍照
- 点击输入框右侧的图片图标
- 在弹出的对话框中选择"拍照"
- 观察相机界面是否强制显示为垂直方向

### 4. 验证方向恢复
- 选择图片或拍照完成后
- 确认返回到应用主界面时屏幕方向恢复正常

### 5. 测试不同设备
- 在横屏设备上测试
- 在竖屏设备上测试
- 确认在所有设备上都强制显示垂直方向

## 预期结果

### 相册界面
- ✅ 相册选择界面强制显示为垂直方向
- ✅ 无论设备当前方向如何，相册界面都保持垂直
- ✅ 相册界面布局适配垂直方向

### 相机界面
- ✅ 相机拍照界面强制显示为垂直方向
- ✅ 相机界面布局适配垂直方向
- ✅ 拍照功能正常工作

### 方向恢复
- ✅ 选择图片完成后自动恢复屏幕方向
- ✅ 拍照完成后自动恢复屏幕方向
- ✅ 应用主界面方向恢复正常

### 用户体验
- ✅ 界面方向一致，用户体验良好
- ✅ 操作流程顺畅，无方向切换问题
- ✅ 功能完整性不受影响

## 技术要点

### 屏幕方向控制
- **强制纵向**：`SCREEN_ORIENTATION_PORTRAIT`
- **恢复默认**：`SCREEN_ORIENTATION_UNSPECIFIED`
- **Intent标志**：`FLAG_ACTIVITY_NEW_TASK`

### 生命周期管理
- **设置方向**：在启动相册/相机前设置
- **恢复方向**：在返回结果后恢复
- **异常处理**：确保Activity存在时才设置

### 兼容性考虑
- **不同设备**：适配各种屏幕尺寸
- **不同系统**：兼容不同Android版本
- **权限处理**：确保相机权限正常

## 相关文件
- `PrescriptionFragment.java` - 主要修改文件
- `AndroidManifest.xml` - 应用配置（已设置portrait）

## 故障排除

### 如果相册界面方向不正确：
1. **检查Intent设置**：确认添加了正确的标志
2. **检查方向设置**：确认设置了`SCREEN_ORIENTATION_PORTRAIT`
3. **检查Activity状态**：确认Activity存在且活跃

### 如果方向恢复异常：
1. **检查恢复方法**：确认`restoreScreenOrientation()`被调用
2. **检查恢复时机**：确认在正确的回调中恢复
3. **检查恢复参数**：确认使用`SCREEN_ORIENTATION_UNSPECIFIED`

### 如果功能异常：
1. **检查权限**：确认相机和存储权限已授予
2. **检查Intent**：确认Intent配置正确
3. **检查回调**：确认ActivityResultLauncher正常工作

## 扩展建议

### 进一步优化
- 可以添加方向切换动画
- 可以增加更多方向控制选项
- 可以优化不同设备的适配

### 功能增强
- 可以添加自定义相册界面
- 可以增加图片预览功能
- 可以优化图片选择体验

## 注意事项

### 系统限制
- 某些系统相册应用可能不完全遵循方向设置
- 不同厂商的相册应用可能有不同的行为
- 系统版本差异可能影响方向控制效果

### 用户体验
- 强制方向可能影响用户习惯
- 需要确保功能完整性不受影响
- 建议在设置中提供方向选择选项
